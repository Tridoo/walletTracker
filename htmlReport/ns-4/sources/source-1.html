


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > PopupOpenerListener</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.tridoo.wallettracker.view</a>
</div>

<h1>Coverage Summary for Class: PopupOpenerListener (com.tridoo.wallettracker.view)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">PopupOpenerListener</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    11,1%
  </span>
  <span class="absValue">
    (1/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    6,2%
  </span>
  <span class="absValue">
    (4/64)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.tridoo.wallettracker.view;
&nbsp;
&nbsp;import android.content.Context;
&nbsp;import android.view.Gravity;
&nbsp;import android.view.LayoutInflater;
&nbsp;import android.view.View;
&nbsp;import android.widget.*;
&nbsp;import com.tridoo.wallettracker.R;
&nbsp;import com.tridoo.wallettracker.common.TransactionDto;
&nbsp;import com.tridoo.wallettracker.wallet.WalletController;
&nbsp;
&nbsp;import java.time.Instant;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.time.ZoneId;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import static android.content.Context.LAYOUT_INFLATER_SERVICE;
&nbsp;
&nbsp;public class PopupOpenerListener implements View.OnClickListener {
&nbsp;
&nbsp;    private final Context context;
&nbsp;
&nbsp;    private final WalletController controller;
&nbsp;
&nbsp;    private String currencyId;
&nbsp;    private String price;
&nbsp;    private final boolean refreshView;
&nbsp;
<b class="fc">&nbsp;    public PopupOpenerListener(Context context, WalletController controller, boolean refreshView) {</b>
<b class="fc">&nbsp;        this.context = context;</b>
<b class="fc">&nbsp;        this.controller = controller;</b>
<b class="fc">&nbsp;        this.refreshView = refreshView;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onClick(View view) {
<b class="nc">&nbsp;        LayoutInflater inflater = (LayoutInflater) context.getSystemService(LAYOUT_INFLATER_SERVICE);</b>
<b class="nc">&nbsp;        View popupView = inflater.inflate(R.layout.popup, null);</b>
<b class="nc">&nbsp;        currencyId = (String) view.getTag(R.string.currencyId);</b>
<b class="nc">&nbsp;        price = (String) view.getTag(R.string.price);</b>
&nbsp;
<b class="nc">&nbsp;        fillTextViews(popupView);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;TransactionDto&gt; transactions = getTransactions(currencyId);</b>
<b class="nc">&nbsp;        fillTransactions(popupView, transactions);</b>
&nbsp;
<b class="nc">&nbsp;        final PopupWindow popupWindow = new PopupWindow(popupView, LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT, true);</b>
<b class="nc">&nbsp;        popupWindow.showAtLocation(view, Gravity.CENTER, 0, 0);</b>
&nbsp;
<b class="nc">&nbsp;        Button btnBuy = popupView.findViewById(R.id.btn_buy);</b>
<b class="nc">&nbsp;        btnBuy.setOnClickListener(btn1 -&gt; {</b>
<b class="nc">&nbsp;            controller.buy(popupView, refreshView);</b>
<b class="nc">&nbsp;            popupWindow.dismiss();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Button btnCancel = popupView.findViewById(R.id.btn_cancel);</b>
<b class="nc">&nbsp;        btnCancel.setOnClickListener(btn2 -&gt; popupWindow.dismiss());</b>
&nbsp;
<b class="nc">&nbsp;        Button btnSell = popupView.findViewById(R.id.btn_sell);</b>
<b class="nc">&nbsp;        btnSell.setOnClickListener(btn3 -&gt; {</b>
<b class="nc">&nbsp;            controller.sell(popupView, refreshView);</b>
<b class="nc">&nbsp;            popupWindow.dismiss();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        Button btnSellAll = popupView.findViewById(R.id.btn_sell_all);</b>
<b class="nc">&nbsp;        btnSellAll.setOnClickListener(btn4 -&gt; {</b>
<b class="nc">&nbsp;            controller.sellAll(currencyId);</b>
<b class="nc">&nbsp;            popupWindow.dismiss();</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        if (transactions.isEmpty()) {</b>
<b class="nc">&nbsp;            hideButtons(popupView, btnSell, btnSellAll);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void fillTextViews(View popupView) {
<b class="nc">&nbsp;        TextView tvId = popupView.findViewById(R.id.tv_id);</b>
<b class="nc">&nbsp;        tvId.setText(currencyId);</b>
&nbsp;
<b class="nc">&nbsp;        EditText etPrice = popupView.findViewById(R.id.et_price);</b>
<b class="nc">&nbsp;        etPrice.setText(price);</b>
<b class="nc">&nbsp;        etPrice.addTextChangedListener(new PriceTextChangedListener(popupView));</b>
&nbsp;
<b class="nc">&nbsp;        EditText etQuantity = popupView.findViewById(R.id.et_quantity);</b>
<b class="nc">&nbsp;        etQuantity.addTextChangedListener(new QuantityTextChangedListener(popupView));</b>
&nbsp;    }
&nbsp;
&nbsp;    private void fillTransactions(View popupView, List&lt;TransactionDto&gt; transactions) {
<b class="nc">&nbsp;        ScrollView sv = popupView.findViewById(R.id.sv_transactions);</b>
<b class="nc">&nbsp;        sv.setVisibility(View.VISIBLE);</b>
<b class="nc">&nbsp;        sv.getLayoutParams().height = Math.min(800, (transactions.size() + 4) * 50);</b>
&nbsp;
<b class="nc">&nbsp;        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        TableLayout table = popupView.findViewById(R.id.tl_transactions);</b>
&nbsp;
<b class="nc">&nbsp;        for (TransactionDto dto : transactions) {</b>
<b class="nc">&nbsp;            LocalDateTime time = Instant.ofEpochMilli(dto.getTime()).atZone(ZoneId.systemDefault()).toLocalDateTime();</b>
&nbsp;
<b class="nc">&nbsp;            TableRow tableRow = new TableRow(context);</b>
<b class="nc">&nbsp;            tableRow.setLayoutParams(new TableRow.LayoutParams(</b>
&nbsp;                    TableRow.LayoutParams.MATCH_PARENT,
&nbsp;                    TableRow.LayoutParams.WRAP_CONTENT));
&nbsp;
<b class="nc">&nbsp;            TextView tv1 = new TextView(context);</b>
<b class="nc">&nbsp;            tv1.setText(time.format(formatter));</b>
<b class="nc">&nbsp;            tv1.setTextAlignment(View.TEXT_ALIGNMENT_TEXT_START);</b>
<b class="nc">&nbsp;            tableRow.addView(tv1);</b>
&nbsp;
<b class="nc">&nbsp;            TextView tv2 = new TextView(context);</b>
<b class="nc">&nbsp;            tv2.setText(dto.getQuantity().toPlainString());</b>
<b class="nc">&nbsp;            tv2.setTextAlignment(View.TEXT_ALIGNMENT_CENTER);</b>
<b class="nc">&nbsp;            tableRow.addView(tv2);</b>
&nbsp;
<b class="nc">&nbsp;            TextView tv3 = new TextView(context);</b>
<b class="nc">&nbsp;            tv3.setText(dto.getValue().toPlainString());</b>
<b class="nc">&nbsp;            tv3.setTextAlignment(View.TEXT_ALIGNMENT_CENTER);</b>
<b class="nc">&nbsp;            tableRow.addView(tv3);</b>
&nbsp;
<b class="nc">&nbsp;            table.addView(tableRow, new TableLayout.LayoutParams(</b>
&nbsp;                    TableLayout.LayoutParams.MATCH_PARENT,
&nbsp;                    TableLayout.LayoutParams.WRAP_CONTENT));
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    private List&lt;TransactionDto&gt; getTransactions(String currencyId) {
<b class="nc">&nbsp;        return controller.getTransactions(currencyId);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static void hideButtons(View popupView, Button btnSell, Button btnSellAll) {
<b class="nc">&nbsp;        btnSellAll.setVisibility(View.INVISIBLE);</b>
<b class="nc">&nbsp;        btnSell.setVisibility(View.INVISIBLE);</b>
<b class="nc">&nbsp;        popupView.findViewById(R.id.btn_sell).setVisibility(View.INVISIBLE);</b>
<b class="nc">&nbsp;        popupView.findViewById(R.id.sv_transactions).setVisibility(View.INVISIBLE);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-11-30 16:39</div>
</div>
</body>
</html>
